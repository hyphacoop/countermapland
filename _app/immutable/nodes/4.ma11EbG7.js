import{a as Ve,v as D,d as L,o as ge,e as z,f as F,h as C,j as A,l as H,p as ze,m as P,q as Y,w as Ie,x as Ce,y as pe,n as Pe,z as _e}from"../chunks/scheduler.6-MFgdjN.js";import{S as Ke,i as Ne,d as N,f as ee,v as Te,g as te,h as ne,b as B,j as S,c as le,m as oe,e as M,l as Be,t as I,a as V,k as be,n as ae,o as ve}from"../chunks/index.GtmoEjJZ.js";import{g as Xe}from"../chunks/object-view.jjZf_z14.js";import{b as qe}from"../chunks/paths.0eiunfsH.js";import{d as ke,w as we}from"../chunks/index.phxjm4wN.js";import{S as Ee,T as Re,L as $,m as ye,a as se,s as J,c as Se,b as x,i as ie,d as Q,e as je,f as We,l as De}from"../chunks/SubmissionSidebar.I1eqmAdt.js";const Le=!1,xe=Object.freeze(Object.defineProperty({__proto__:null,ssr:Le},Symbol.toStringTag,{value:"Module"})),{console:Fe}=Xe,K="src/routes/objects/+page.svelte";function Oe(n,e,t){const l=n.slice();return l[20]=e[t],l[22]=t,l}function Me(n,e,t){const l=n.slice();return l[23]=e[t].url,l[24]=e[t].alt,l[26]=t,l}function re(n){let e,t=ee(n[20].photos),l=[];for(let a=0;a<t.length;a+=1)l[a]=ce(Me(n,t,a));const s={c:function(){e=z("div");for(let i=0;i<l.length;i+=1)l[i].c();this.h()},l:function(i){e=C(i,"DIV",{class:!0,key:!0});var u=A(e);for(let c=0;c<l.length;c+=1)l[c].l(u);u.forEach(B),this.h()},h:function(){S(e,"class","image-container s-BO-laqXqKOol"),S(e,"key",n[22]),P(e,K,222,8,7917)},m:function(i,u){le(i,e,u);for(let c=0;c<l.length;c+=1)l[c]&&l[c].m(e,null)},p:function(i,u){if(u&1034){t=ee(i[20].photos);let c;for(c=0;c<t.length;c+=1){const w=Me(i,t,c);l[c]?l[c].p(w,u):(l[c]=ce(w),l[c].c(),l[c].m(e,null))}for(;c<l.length;c+=1)l[c].d(1);l.length=t.length}},d:function(i){i&&B(e),Ie(l,i)}};return N("SvelteRegisterBlock",{block:s,id:re.name,type:"if",source:"(222:6) {#if marker.photos && marker.photos.length}",ctx:n}),s}function ce(n){let e,t,l,s,a,i;function u(){return n[13](n[20])}const c={c:function(){e=z("div"),t=z("img"),this.h()},l:function(_){e=C(_,"DIV",{class:!0,style:!0});var d=A(e);t=C(d,"IMG",{src:!0,alt:!0,key:!0,class:!0}),d.forEach(B),this.h()},h:function(){_e(t.src,l=`https://www.veterans.gc.ca/images/remembrance/memorials/national-inventory-canadian-memorials/mem/${n[23]}`)||S(t,"src",l),S(t,"alt",s=n[24]),S(t,"key",n[26]),S(t,"class","s-BO-laqXqKOol"),P(t,K,229,14,8265),S(e,"class","photo-wrapper s-BO-laqXqKOol"),Y(e,"top",Z(n[26],n[22],n[3]).top+"px"),Y(e,"left",Z(n[26],n[22],n[3]).left+"px"),P(e,K,224,12,8031)},m:function(_,d){le(_,e,d),M(e,t),a||(i=Be(t,"click",u,!1,!1,!1,!1),a=!0)},p:function(_,d){n=_,d&2&&!_e(t.src,l=`https://www.veterans.gc.ca/images/remembrance/memorials/national-inventory-canadian-memorials/mem/${n[23]}`)&&S(t,"src",l),d&2&&s!==(s=n[24])&&S(t,"alt",s),d&8&&Y(e,"top",Z(n[26],n[22],n[3]).top+"px"),d&8&&Y(e,"left",Z(n[26],n[22],n[3]).left+"px")},d:function(_){_&&B(e),a=!1,i()}};return N("SvelteRegisterBlock",{block:c,id:ce.name,type:"each",source:"(224:10) {#each marker.photos as { url, alt }",ctx:n}),c}function fe(n){let e,t=n[20].photos&&n[20].photos.length&&re(n);const l={c:function(){t&&t.c(),e=pe()},l:function(a){t&&t.l(a),e=pe()},m:function(a,i){t&&t.m(a,i),le(a,e,i)},p:function(a,i){a[20].photos&&a[20].photos.length?t?t.p(a,i):(t=re(a),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},d:function(a){a&&B(e),t&&t.d(a)}};return N("SvelteRegisterBlock",{block:l,id:fe.name,type:"each",source:"(221:4) {#each $visibleRandomMarkers as marker, index}",ctx:n}),l}function ue(n){let e,t;e=new je({$$inline:!0});const l={c:function(){te(e.$$.fragment)},l:function(a){ne(e.$$.fragment,a)},m:function(a,i){oe(e,a,i),t=!0},i:function(a){t||(I(e.$$.fragment,a),t=!0)},o:function(a){V(e.$$.fragment,a),t=!1},d:function(a){ae(e,a)}};return N("SvelteRegisterBlock",{block:l,id:ue.name,type:"if",source:"(243:2) {#if $selectedMarkerId}",ctx:n}),l}function me(n){let e,t;e=new We({$$inline:!0}),e.$on("closeSideBar",n[12]);const l={c:function(){te(e.$$.fragment)},l:function(a){ne(e.$$.fragment,a)},m:function(a,i){oe(e,a,i),t=!0},p:Pe,i:function(a){t||(I(e.$$.fragment,a),t=!0)},o:function(a){V(e.$$.fragment,a),t=!1},d:function(a){ae(e,a)}};return N("SvelteRegisterBlock",{block:l,id:me.name,type:"if",source:"(246:2) {#if $currentSidebar === 'submissions'}",ctx:n}),l}function de(n){let e,t,l,s,a,i,u,c="*countermap",w,_,d,v,q,E,R,T,G;t=new Ee({$$inline:!0}),t.$on("updateView",n[9]),s=new Re({props:{mapInstance:n[0],objectView:!0},$$inline:!0}),s.$on("zoom",n[7]);let j=ee(n[1]),b=[];for(let O=0;O<j.length;O+=1)b[O]=fe(Oe(n,j,O));let h=n[4]&&ue(n),g=n[5]==="submissions"&&me(n);const U={c:function(){e=z("main"),te(t.$$.fragment),l=F(),te(s.$$.fragment),a=F(),i=z("h1"),u=z("a"),u.textContent=c,w=F(),_=z("div");for(let m=0;m<b.length;m+=1)b[m].c();d=F(),v=z("div"),q=F(),h&&h.c(),E=F(),g&&g.c(),this.h()},l:function(m){e=C(m,"MAIN",{class:!0});var p=A(e);ne(t.$$.fragment,p),l=H(p),ne(s.$$.fragment,p),a=H(p),i=C(p,"H1",{class:!0});var o=A(i);u=C(o,"A",{href:!0,class:!0,"data-svelte-h":!0}),ze(u)!=="svelte-hi9bqo"&&(u.textContent=c),o.forEach(B),w=H(p),_=C(p,"DIV",{class:!0});var r=A(_);for(let f=0;f<b.length;f+=1)b[f].l(r);d=H(r),v=C(r,"DIV",{id:!0,style:!0}),A(v).forEach(B),r.forEach(B),q=H(p),h&&h.l(p),E=H(p),g&&g.l(p),p.forEach(B),this.h()},h:function(){S(u,"href",qe+"/map"),S(u,"class","s-BO-laqXqKOol"),P(u,K,218,6,7739),S(i,"class","s-BO-laqXqKOol"),P(i,K,218,2,7735),S(v,"id","map"),Y(v,"display","none"),P(v,K,240,4,8609),S(_,"class","image-grid s-BO-laqXqKOol"),P(_,K,219,2,7783),S(e,"class","s-BO-laqXqKOol"),P(e,K,215,0,7544)},m:function(m,p){le(m,e,p),oe(t,e,null),M(e,l),oe(s,e,null),M(e,a),M(e,i),M(i,u),M(e,w),M(e,_);for(let o=0;o<b.length;o+=1)b[o]&&b[o].m(_,null);M(_,d),M(_,v),M(e,q),h&&h.m(e,null),M(e,E),g&&g.m(e,null),n[14](e),R=!0,T||(G=Be(e,"click",n[11],!1,!1,!1,!1),T=!0)},p:function(m,[p]){const o={};if(p&1&&(o.mapInstance=m[0]),s.$set(o),p&1034){j=ee(m[1]);let r;for(r=0;r<j.length;r+=1){const f=Oe(m,j,r);b[r]?b[r].p(f,p):(b[r]=fe(f),b[r].c(),b[r].m(_,d))}for(;r<b.length;r+=1)b[r].d(1);b.length=j.length}m[4]?h?p&16&&I(h,1):(h=ue(m),h.c(),I(h,1),h.m(e,E)):h&&(ve(),V(h,1,1,()=>{h=null}),be()),m[5]==="submissions"?g?(g.p(m,p),p&32&&I(g,1)):(g=me(m),g.c(),I(g,1),g.m(e,null)):g&&(ve(),V(g,1,1,()=>{g=null}),be())},i:function(m){R||(I(t.$$.fragment,m),I(s.$$.fragment,m),I(h),I(g),R=!0)},o:function(m){V(t.$$.fragment,m),V(s.$$.fragment,m),V(h),V(g),R=!1},d:function(m){m&&B(e),ae(t),ae(s),Ie(b,m),h&&h.d(),g&&g.d(),n[14](null),T=!1,G()}};return N("SvelteRegisterBlock",{block:U,id:de.name,type:"component",source:"",ctx:n}),U}function Z(n,e,t){const i=Math.floor(t/116),u=Math.floor(e/i),c=e%i,w=Math.random()*100,_=Math.random()*100,d=n*116,v=u*166+w,E=c*116+_+d;return{top:v,left:E}}function He(n,e){const s=Math.floor(e/216),a=Math.floor(n/s),i=n%s,u=a*216,c=i*216;return{top:u,left:c}}function Ae(n,e,t){let l,s,a,i,u,c;D(x,"mapInstanceStore"),L(n,x,o=>t(0,l=o)),D(ie,"initialViewStore"),L(n,ie,o=>t(16,i=o)),D(J,"selectedMarkerId"),L(n,J,o=>t(4,u=o)),D(Q,"currentSidebar"),L(n,Q,o=>t(5,c=o));let{$$slots:w={},$$scope:_}=e;Te("Page",w,[]);let d=we(4);D(d,"zoomLevel"),L(n,d,o=>t(15,a=o));let v,q;ge(()=>{v&&t(3,q=v.offsetWidth),!l&&(map=$.map("map",{center:[i[0],i[1]],zoom:a}),x.set(map),map.on("zoomend",()=>{d.set(map.getZoom())}))});function E(o){const{dir:r}=o.detail;d.update(f=>r==="in"?f<4?f+1:3:r==="out"?f>2?f-1:4:f)}const R=ke([ye,se,d],([o,r,f])=>{if(!r||typeof r.contains!="function")return[];const k=o.filter(y=>{const[W,X]=y.latLng;return r.contains($.latLng(W,X))});for(let y=k.length-1;y>0;y--){const W=Math.floor(Math.random()*(y+1));[k[y],k[W]]=[k[W],k[y]]}return k.slice(0,f)});D(R,"visibleRandomMarkers"),L(n,R,o=>t(1,s=o));function T(o,r){console.log("calculating bounds",o);const f=parseFloat(o[0]),k=parseFloat(o[1]);return $.latLngBounds([f-r,k-r],[f+r,k+r])}function G(o,r,f=10){if(console.log("Calculating bounds for:",o,"Index:",r,"GridSpacing:",f),!o||isNaN(o.lat)||isNaN(o.lng))return console.error("Invalid startLatLng:",o),null;const k=Math.floor(r/3),y=r%3,W=k*f,X=y*f,he=$.latLng(o.lat-W,o.lng+X),$e=$.latLng(o.lat-W-f,o.lng+X+f);return $.latLngBounds(he,$e)}function j(o,r,f,k,y){console.log("LatLng",k,"Index",y);const W={lat:k[0],lng:k[1]},X=G(W,y,.001);$.imageOverlay(r,X,{alt:f}).addTo(o)}function b(o){console.log("updating view");const{latLng:r}=o.detail,f=T(r,.1);se.set(f),Se.set({lat:r[0],lng:r[1]})}function h(o){J.set(o.id)}function g(o){o.target===o.currentTarget&&(J.set(null),Q.set(null))}function U(){console.log("closing sidebar"),Q.set(null)}const O=[];Object.keys(e).forEach(o=>{!~O.indexOf(o)&&o.slice(0,2)!=="$$"&&o!=="slot"&&Fe.warn(`<Page> was created with unknown prop '${o}'`)});const m=o=>h(o);function p(o){Ce[o?"unshift":"push"](()=>{v=o,t(2,v)})}return n.$capture_state=()=>({onMount:ge,base:qe,writable:we,derived:ke,markersStore:ye,mapBoundsStore:se,selectedMarkerId:J,currentViewStore:Se,mapInstanceStore:x,initialViewStore:ie,currentSidebar:Q,Sidebar:je,SubmissionSidebar:We,Search:Ee,Toolbar:Re,L:$,latLngBounds:De.latLngBounds,zoomLevel:d,mainElement:v,mainWidth:q,getTransformation:Z,getCellPosition:He,updateZoom:E,visibleRandomMarkers:R,calculateBoundsFromSearch:T,calculateImageBounds:G,addImageOverlay:j,handleUpdateView:b,handleImageClick:h,handleMainClick:g,closeSidebar:U,$mapInstanceStore:l,$visibleRandomMarkers:s,$zoomLevel:a,$initialViewStore:i,$selectedMarkerId:u,$currentSidebar:c}),n.$inject_state=o=>{"zoomLevel"in o&&t(6,d=o.zoomLevel),"mainElement"in o&&t(2,v=o.mainElement),"mainWidth"in o&&t(3,q=o.mainWidth)},e&&"$$inject"in e&&n.$inject_state(e.$$inject),n.$$.update=()=>{n.$$.dirty&3&&l&&s.length>0&&s.forEach((o,r)=>{o.photos&&o.photos.forEach(f=>{const k=`https://www.veterans.gc.ca/images/remembrance/memorials/national-inventory-canadian-memorials/mem/${f.url}`,y=[o.latLng[0],o.latLng[1]];j(l,k,f.alt,y,o.id)})})},[l,s,v,q,u,c,d,E,R,b,h,g,U,m,p]}class et extends Ke{constructor(e){super(e),Ne(this,e,Ae,de,Ve,{}),N("SvelteRegisterComponent",{component:this,tagName:"Page",options:e,id:de.name})}}export{et as component,xe as universal};
